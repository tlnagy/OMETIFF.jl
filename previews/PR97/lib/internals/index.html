<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internals · OMETIFF.jl Documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">OMETIFF.jl Documentation</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Library</span><ul><li class="is-active"><a class="tocitem" href>Internals</a><ul class="internal"><li><a class="tocitem" href="#Common-1"><span>Common</span></a></li><li><a class="tocitem" href="#Types-1"><span>Types</span></a></li><li><a class="tocitem" href="#Logic-1"><span>Logic</span></a></li><li><a class="tocitem" href="#Construction-1"><span>Construction</span></a></li><li><a class="tocitem" href="#Miscellaneous-1"><span>Miscellaneous</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Internals</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Internals</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tlnagy/OMETIFF.jl/blob/master/docs/src/lib/internals.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Internals-1"><a class="docs-heading-anchor" href="#Internals-1">Internals</a><a class="docs-heading-anchor-permalink" href="#Internals-1" title="Permalink"></a></h1><p>Documentation for all non-exported functions can be found below:</p><h2 id="Common-1"><a class="docs-heading-anchor" href="#Common-1">Common</a><a class="docs-heading-anchor-permalink" href="#Common-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.load" href="#OMETIFF.load"><code>OMETIFF.load</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load(io; dropunused, verbose, inmemory) -&gt; ImageMetadata.ImageMeta</code></pre><p>Load an OMETIFF file using the stream <code>io</code>.</p><p><strong>Arguments</strong></p><ul><li><code>dropunused::Bool</code>: controls whether dimensions of length 1 are dropped automatically (default) or not.</li><li><code>verbose::Bool</code>: if true then prints a progress bar during loading</li><li><code>inmemory::Bool</code>: controls whether arrays are fully loaded into memory (default) or left on disk and specific parts only loaded when accessed.</li></ul><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>The <code>inmemory=false</code> flag currently returns a read-only view of the data on the disk for data integrity reasons. In order to modify the contents, you must copy the data into an in-memory container–at least until <a href="https://github.com/tlnagy/OMETIFF.jl/issues/52">#52</a> is fixed–like so:</p><pre><code class="language-none">copy(arr)</code></pre></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/loader.jl#L7-L28">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.dump_omexml" href="#OMETIFF.dump_omexml"><code>OMETIFF.dump_omexml</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">dump_omexml(filepath) -&gt; String</code></pre><p>Returns the OME-XML embedded inside the OME-TIFF as a prettified string.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/files.jl#L164-L168">source</a></section></article><h2 id="Types-1"><a class="docs-heading-anchor" href="#Types-1">Types</a><a class="docs-heading-anchor-permalink" href="#Types-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.DiskOMETaggedImage" href="#OMETIFF.DiskOMETaggedImage"><code>OMETIFF.DiskOMETaggedImage</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A lazy representation of a OMETIFF file. This custom type is needed since TIFF files are laid out noncontiguously and nonregularly. It uses an internal index to determine the mapping from indices to the locations of data slices on disk. These slices are generally XY slices and are usually loaded in all at once so it is quickly loaded into an internal cache to speed up the process. Externally, this type should behave very similarly to an in-memory array, albeit with a higher cost of accessing an element.</p><ul><li><p><code>ifds</code></p><p>A map of dimensions (sans XY) to the corresponding <a href="#TiffImages.TiffFile"><code>TiffFile</code></a> and <a href="#TiffImages.IFD"><code>IFD</code></a></p></li></ul><ul><li><p><code>dims</code></p><p>The full set of dimensions of the TIFF file, including XY</p></li></ul><ul><li><p><code>cache</code></p><p>An internal cache to fill when reading from disk</p></li></ul><ul><li><p><code>cache_index</code></p><p>The dimension indices corresponding to the slice currently in the cache</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/mmap.jl#L1-L13">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TiffImages.IFD" href="#TiffImages.IFD"><code>TiffImages.IFD</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct IFD{O&lt;:Unsigned}</code></pre><p>An image file directory is a sorted collection of the tags representing this plane in the TIFF file. They behave like dictionaries except that tags aren&#39;t required to be unique, so given an IFD called <code>ifd</code>, we can add new tags as follows:</p><pre><code class="language-julia-repl">julia&gt; ifd[TiffImages.IMAGEDESCRIPTION] = &quot;Some details&quot;;

julia&gt; ifd[TiffImages.IMAGEWIDTH] = 512;

julia&gt; ifd
IFD, with tags:
	Tag(IMAGEWIDTH, 512)
	Tag(IMAGEDESCRIPTION, &quot;Some details&quot;)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Tags are not required to be unique! See <a href="lib/@ref"><code>TiffImages.Iterable</code></a> for how to work with duplicate tags.</p></div></div></div></section></article><article class="docstring"><header><a class="docstring-binding" id="TiffImages.TiffFile" href="#TiffImages.TiffFile"><code>TiffImages.TiffFile</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct TiffFile{O&lt;:Unsigned, S&lt;:FileIO.Stream}</code></pre><p>-&gt; TiffFile</p><p>Wrap <code>io</code> with helper parameters to keep track of file attributes.</p><ul><li><p><code>uuid</code></p><p>A unique identifier for this file</p></li><li><p><code>filepath</code></p><p>The relative path to this file</p></li><li><p><code>io</code></p><p>The file stream</p></li><li><p><code>first_offset</code></p><p>Location of the first IFD in the file stream</p></li><li><p><code>need_bswap</code></p><p>Whether this file has a different endianness than the host computer</p></li></ul></div></section></article><h2 id="Logic-1"><a class="docs-heading-anchor" href="#Logic-1">Logic</a><a class="docs-heading-anchor-permalink" href="#Logic-1" title="Permalink"></a></h2><p>These are the key logic functions that work through the OME and TIFF data and determine the mapping between these two. Future changes to the OME specification should be handle in these functions.</p><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.ifdindex!" href="#OMETIFF.ifdindex!"><code>OMETIFF.ifdindex!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ifdindex!(ifd_index, ifd_files, obs_filepaths, image, dims, tifffile, posidx)
</code></pre><p>OMEXML is <a href="https://docs.openmicroscopy.org/ome-model/6.0.1/ome-tiff/specification.html#fragment-1">very flexible</a> with its representation of the IFDs in the TIFF image. This function attempts to handle many of the exceptions and update the passed collections with the proper mapping of which TiffData elements correspond to which IFDs (and which files these IFDs are located in) inside the TIFF image.</p><p><strong>Arguments</strong></p><ul><li><code>ifd_index::OrderedDict{Int, NTuple{4, Int}}</code>: A mapping from IFD number to dimensions</li><li><code>ifd_files::OrderedDict{Int, Tuple{String, String}}</code>: A mapping from IFD number to the filepath and UUID of the file it&#39;s located in</li><li><code>obs_filepaths::Dict{String, Int}</code>: A list of observed filepaths mapped to the offset of their IFDs</li><li><code>image::EzXML.Node</code>: The OMEXML rooted at the current position</li><li><code>dims::NamedTuple</code>: Sizes of each dimension with the names as keys</li><li><code>tifffile::TiffFile</code>: A pointer to the root file</li><li><code>posidx::Int</code>: The index of the current position</li></ul><p>The first two parameters should be then pumped through <a href="#OMETIFF.get_ifds"><code>OMETIFF.get_ifds</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/parsing.jl#L19-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.get_ifds" href="#OMETIFF.get_ifds"><code>OMETIFF.get_ifds</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_ifds(orig_file, ifd_index, ifd_files) -&gt; Dict, Dict</code></pre><p>Run through all the IFDs extracted from the OMEXML and open all the referenced files to construct a mapping of ZCTP (not guaranteed order) index to IFD object. This is necessary because there can be multiple files referenced in a single OMEXML and we need to iterate over the files to identify the actual offsets for the data since this information isn&#39;t found in the OMEXML.</p><p><strong>Output</strong></p><ul><li><code>Dict{Tuple{String, String}, TiffFile}</code>: a mapping of filepath, UUID to the  actual TiffFile object</li><li><code>OrderedDict{NTuple{4, Int}, IFD}</code>: a mapping of ZCTP (or other order) index  to the IFD objects in order that the IFDs are referenced in the OMEXML</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/files.jl#L19-L33">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.build_axes" href="#OMETIFF.build_axes"><code>OMETIFF.build_axes</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">build_axes(image) -&gt; Tuple, Vector</code></pre><p>Extracts the dimensions and axis information from the OMEXML data.</p><p><strong>Output</strong></p><ul><li><code>NamedTuple{order, NTuple{6, Int}}</code>: the labeled 6 dimensions in the <code>order</code> that they are specified in the OMEXML.</li><li><code>Vector{AxisArray.Axis}</code>: List of <code>AxisArray.Axis</code> objects with units (if possible) in the same <code>order</code> as above</li></ul><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>There&#39;s no guarantee that the dimension sizes extracted here are correct if the acquisition was cancelled during a multiposition session. See <a href="https://github.com/tlnagy/OMETIFF.jl/issues/38">#38</a>. Downstream functions should be flexible and handle these cases.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/parsing.jl#L137-L153">source</a></section></article><h2 id="Construction-1"><a class="docs-heading-anchor" href="#Construction-1">Construction</a><a class="docs-heading-anchor-permalink" href="#Construction-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.inmemoryarray" href="#OMETIFF.inmemoryarray"><code>OMETIFF.inmemoryarray</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">inmemoryarray(ifds, dims, rawtype, mappedtype) -&gt; Array</code></pre><p>Builds an in-memory high-dimensional image using the mapping provided by <code>ifds</code> from indices to <a href="#TiffImages.IFD"><code>OMETIFF.IFD</code></a> objects. The IFD objects store handles to the file objects and the offsets for the data. <code>dims</code> stores the size of each named dimension. The <code>rawtype</code> parameter describes the storage layout of each element on disk and <code>mappedtype</code> is the corresponding fixed or floating point type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/loader.jl#L114-L123">source</a></section></article><h2 id="Miscellaneous-1"><a class="docs-heading-anchor" href="#Miscellaneous-1">Miscellaneous</a><a class="docs-heading-anchor-permalink" href="#Miscellaneous-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Base.iterate" href="#Base.iterate"><code>Base.iterate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">iterate(iter [, state]) -&gt; Union{Nothing, Tuple{Any, Any}}</code></pre><p>Advance the iterator to obtain the next element. If no elements remain, <code>nothing</code> should be returned. Otherwise, a 2-tuple of the next element and the new iteration state should be returned.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/742b9abb4dd4621b667ec5bb3434b8b3602f96fd/base/essentials.jl#L884-L890">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.get_elapsed_times" href="#OMETIFF.get_elapsed_times"><code>OMETIFF.get_elapsed_times</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_elapsed_times(containers, master_dims, masteraxis; default_unit)
</code></pre><p>-&gt; AxisArray</p><p>Extracts the actual acquisition times from the OME-XML data. Takes <code>containers</code>, a vector of the XML nodes corresponding to the root of each image.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/parsing.jl#L181-L186">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.get_unitful_axis" href="#OMETIFF.get_unitful_axis"><code>OMETIFF.get_unitful_axis</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">get_unitful_axis(image, dimsize, stepsize, units) -&gt; Range</code></pre><p>Attempts to return a unitful range with a length of <code>dimsize</code>. Parameters <code>stepsize</code> and <code>units</code> should be the XML tags in <code>image</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/parsing.jl#L112-L117">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.load_comments" href="#OMETIFF.load_comments"><code>OMETIFF.load_comments</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load_comments(file) -&gt; String</code></pre><p>Extracts the MicroManager embedded description, if present. Else returns an empty string.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/files.jl#L182-L187">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.load_master_xml" href="#OMETIFF.load_master_xml"><code>OMETIFF.load_master_xml</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">load_master_xml(file::TiffFile) -&gt; EzXML.doc</code></pre><p>Loads the master OME-XML file from <code>file</code> or from a linked file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/files.jl#L103-L107">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OMETIFF.to_symbol" href="#OMETIFF.to_symbol"><code>OMETIFF.to_symbol</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">to_symbol(input) -&gt; String</code></pre><p>Cleans up <code>input</code> string and converts it into a symbol, needed so that channel names work with AxisArrays.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/tlnagy/OMETIFF.jl/blob/fa6e7f570941880732b70f2269af1c16321b6878/src/utils.jl#L1-L6">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 20 June 2022 23:15">Monday 20 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
